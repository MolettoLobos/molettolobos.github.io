<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Italo Moletto Lobos - CV</title>

  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" />

  <!-- Styles -->
  <link rel="stylesheet" href="style.css">

  <!-- PDF library -->
  <script src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"></script>

  <style>
    /* Ajustes base para clones PDF */
    .pdf-root, .pdf-root * { background: #ffffff !important; }
    .pdf-root .card,
    .pdf-root section,
    .pdf-root .personal-data {
      break-inside: auto !important;
      page-break-inside: auto !important;
    }
    .page-break { break-before: page; page-break-before: always; }
  </style>
</head>
<body>
  <!-- Header compacto SOLO para imprimir -->
  <div id="print-header" class="print-header" aria-hidden="true"></div>

  <div class="header-wrapper">
    <header id="header"></header>
    <div class="profile-wrapper">
      <img class="profile-pic" src="your-photo.jpg" alt="Italo Moletto" crossorigin="anonymous" />
    </div>
  </div>

  <div class="container">
    <!-- ===== Education ===== -->
    <section id="education">
      <h2>Education</h2>
      <div id="education-card" class="card big-edu-card">
        <div id="education-list"></div>
      </div>
    </section>

    <section id="experience">
      <h2>Experience</h2>
      <!-- Un solo card que contiene TODO -->
      <div id="experience-card" class="card big-experience-card">
        <div id="experience-list"></div>
      </div>
    </section>

    <!-- ===== Projects ===== -->
    <section id="projects">
      <h2>Projects</h2>
      <div id="projects-card" class="card big-projects-card">
        <!-- Toggle √∫nico -->
        <details id="projects-details" class="projects-details">
          <summary class="projects-summary">
            <span id="projects-summary-text">Projects</span>
            <span class="projects-summary-hint">‚Äî click to expand</span>
          </summary>
          <div id="project-list"></div>
        </details>
      </div>
    </section>

    <section>
      <h2>Skills</h2>
      <div id="skills-list"></div>
    </section>

    <section>
      <h2>Scientific profiles</h2>
      <div id="science-list"></div>
    </section>

    <section>
      <h2>In press</h2>
      <div id="press-list"></div>
    </section>

    <section class="personal-data">
      <h2>Personal Data</h2>
      <div class="card" id="personal-data"></div>
    </section>
  </div>

  <footer>
    <div class="pdf-btn-wrapper" style="display:flex; gap:10px; justify-content:center; flex-wrap:wrap;">
      <button id="btn-pdf" class="print-btn" aria-label="Download PDF">
        <i class="fas fa-file-arrow-down" aria-hidden="true"></i> Download PDF
      </button>
      <button id="btn-pdf-simplified" class="print-btn" aria-label="Download PDF (simplified)">
        <i class="fas fa-file-circle-minus" aria-hidden="true"></i> Download PDF (simplified)
      </button>
    </div>
    <p>&copy; 2025 Italo Moletto Lobos ‚Äî Remote Sensing & AI</p>
  </footer>

  <!-- Contenedor del clon simplificado (se crea din√°micamente) -->
  <div id="pdf-simplified" class="pdf-root" style="display:none;"></div>

<script>
  // Colecci√≥n de promesas de carga
  const loaders = [];

  // Guardamos data global para reutilizar en "simplified"
  let headerData = null;
  let educationData = null;
  let experienceData = null;
  let skillsData = null;
  let scienceData = null;
  let personalData = null;

  // ------------ Header ------------
  loaders.push(
    fetch('header.json')
      .then(r => r.json())
      .then(data => {
        headerData = data;
        const header = document.getElementById('header');
        const phones = (data.phones || []).join(' / ');
        const emails = (data.emails || []).join(' / ');

        // Header pantalla
        header.innerHTML = `
          <h1>${data.name || ''}</h1>
          <p>${data.subtitle || ''}</p>
          <div class="contact-info">
            ${phones ? `<span><i class="fas fa-phone"></i> ${phones}</span>` : ''}
            ${emails ? `<span><i class="fas fa-envelope"></i> ${emails}</span>` : ''}
            ${data.linkedin ? `<a href="${data.linkedin}" target="_blank" rel="noopener"><i class="fab fa-linkedin"></i> LinkedIn</a>` : ''}
          </div>
        `;

        // Header SOLO impresi√≥n (compacto)
        const ph = document.getElementById('print-header');
        ph.innerHTML = `
          <img class="print-avatar" src="your-photo.jpg" alt="${data.name || 'Photo'}" crossorigin="anonymous" />
          <div class="identity">
            <h1>${data.name || ''}</h1>
            <p>${data.subtitle || ''}</p>
            <div class="contact-line">
              ${phones ? `<span>üìû ${phones}</span>` : ''}
              ${emails ? `<span>‚úâÔ∏è ${emails}</span>` : ''}
            </div>
          </div>
        `;
      })
  );

  // ------------ Education ------------
  loaders.push(
    fetch('education.json')
      .then(r => r.json())
      .then(data => {
        educationData = data;
        const list = document.getElementById('education-list');
        data.forEach(ed => {
          const block = document.createElement('div');
          block.className = 'edu-block';
          const notes = (ed.notes || []).map(n => `<li>${n}</li>`).join('');
          block.innerHTML = `
            <h3 class="edu-degree">${ed.degree || ''}</h3>
            <p class="meta">${ed.institution || ''}${ed.location ? ' ¬∑ ' + ed.location : ''}</p>
            <p class="date">${ed.date || ''}</p>
            ${notes ? `<ul>${notes}</ul>` : ''}
          `;
          list.appendChild(block);
        });
      })
  );

  // ------------ Experience ------------
  loaders.push(
    fetch('experience.json')
      .then(r => r.json())
      .then(data => {
        experienceData = data;
        const list = document.getElementById('experience-list');
        data.forEach(org => {
          const block = document.createElement('div');
          block.className = 'employer-block';

          const rolesHTML = (org.roles || []).map(role => {
            const items = (role.items || []).map(i => `<li>${i}</li>`).join('');
            return `
              <div class="role">
                <h4 class="role-title">${role.title || ''}</h4>
                <p class="date">${role.date || ''}</p>
                ${items ? `<ul>${items}</ul>` : ''}
              </div>
            `;
          }).join('');

          block.innerHTML = `
            <h3 class="employer-name">${org.employer || ''}</h3>
            ${org.location ? `<p class="meta">${org.location}</p>` : ''}
            ${rolesHTML}
          `;
          list.appendChild(block);
        });
      })
  );

  // ------------ Projects ------------
  loaders.push(
    fetch('projects.json')
      .then(r => r.json())
      .then(data => {
        const details = document.getElementById('projects-details');
        const summaryText = document.getElementById('projects-summary-text');
        const list = document.getElementById('project-list');

        summaryText.textContent = `Projects (${data.length})`;

        data.forEach(project => {
          const block = document.createElement('div');
          block.className = 'project-block';
          const metaBits = [];
          if (project.employer) metaBits.push(project.employer);
          if (project.country)  metaBits.push(project.country);
          const meta = metaBits.length ? `<span class="meta">${metaBits.join(' ¬∑ ')}</span>` : '';
          const code = project.code ? `<span class="code"><strong>${project.code}</strong></span>` : '';

          block.innerHTML = `
            <h3 class="project-title">${project.title || ''}</h3>
            <div class="project-sub">
              ${project.date ? `<span class="date">${project.date}</span>` : ''}
              ${meta}${code ? ` ¬∑ ${code}` : ''}
            </div>
            ${project.description ? `<p class="project-desc">${project.description}</p>` : ''}
          `;
          list.appendChild(block);
        });

        // Auto-open para imprimir y cerrar despu√©s (solo en vista normal)
        const openForPrint = () => details.setAttribute('open', 'open');
        const closeAfterPrint = () => details.removeAttribute('open');
        if (window.matchMedia) {
          window.matchMedia('print').addEventListener('change', e => {
            if (e.matches) openForPrint(); else closeAfterPrint();
          });
        }
        window.addEventListener('beforeprint', openForPrint);
        window.addEventListener('afterprint', closeAfterPrint);
      })
  );

  // ------------ Skills ------------
  loaders.push(
    fetch('skills.json')
      .then(r => r.json())
      .then(data => {
        skillsData = data;
        const container = document.getElementById('skills-list');
        const card = document.createElement('div');
        card.className = 'card';
        let html = '';
        if (data.technical?.length) {
          html += '<h3>Technical Skills</h3><ul>';
          data.technical.forEach(skill => html += `<li>${skill}</li>`);
          html += '</ul>';
        }
        if (data.languages?.length) {
          html += '<h3>Languages</h3><ul>';
          data.languages.forEach(lang => html += `<li>${lang}</li>`);
          html += '</ul>';
        }
        card.innerHTML = html;
        container.appendChild(card);
      })
  );

  // ------------ Personal Data ------------
  loaders.push(
    fetch('personal.json')
      .then(r => r.json())
      .then(data => {
        personalData = data;
        const container = document.getElementById('personal-data');
        container.innerHTML = `
          <p><strong>Nationality:</strong> ${data.nationality || ''}</p>
          <p><strong>Born date:</strong> ${data.birthdate || ''}</p>
        `;
      })
  );

  // ------------ Scientific profile ------------
  loaders.push(
    fetch('science.json')
      .then(r => r.json())
      .then(data => {
        scienceData = data;
        const container = document.getElementById('science-list');
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = '<ul>' +
          data.map(link => `<li><a href="${link.url}" target="_blank" rel="noopener">${link.label}</a></li>`).join('') +
          '</ul>';
        container.appendChild(card);
      })
  );

  // ------------ In press ------------
  loaders.push(
    fetch('press.json')
      .then(r => r.json())
      .then(data => {
        const container = document.getElementById('press-list');
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = '<ul>' +
          data.map(link => `<li><a href="${link.url}" target="_blank" rel="noopener">${link.label}</a></li>`).join('') +
          '</ul>';
        container.appendChild(card);
      })
  );

  // ------------ PDF Download (completo) ------------
  const pdfBtn = document.getElementById('btn-pdf');
  pdfBtn.addEventListener('click', async () => {
    await Promise.all(loaders);
    if (document.fonts?.ready) await document.fonts.ready;
    window.print();
  });

  // ------------ PDF Download (simplified) ------------
  const pdfSimplifiedBtn = document.getElementById('btn-pdf-simplified');

  function buildSimplifiedDOM() {
    const root = document.getElementById('pdf-simplified');
    root.innerHTML = ''; // limpiar

    const wrapper = document.createElement('div');
    wrapper.className = 'container simplified-container';

    // Header compacto
    const printHeaderClone = document.createElement('div');
    printHeaderClone.className = 'print-header simplified-print-header';
    printHeaderClone.innerHTML = document.getElementById('print-header').innerHTML;
    wrapper.appendChild(printHeaderClone);

    // Education (igual)
    const secEdu = document.createElement('section');
    secEdu.innerHTML = `<h2>Education</h2>`;
    const cardEdu = document.createElement('div');
    cardEdu.className = 'card';
    const listEdu = document.createElement('div');

    (educationData || []).forEach(ed => {
      const block = document.createElement('div');
      block.className = 'edu-block';
      const notes = (ed.notes || []).map(n => `<li>${n}</li>`).join('');
      block.innerHTML = `
        <h3 class="edu-degree">${ed.degree || ''}</h3>
        <p class="meta">${ed.institution || ''}${ed.location ? ' ¬∑ ' + ed.location : ''}</p>
        <p class="date">${ed.date || ''}</p>
        ${notes ? `<ul>${notes}</ul>` : ''}
      `;
      listEdu.appendChild(block);
    });
    cardEdu.appendChild(listEdu);
    secEdu.appendChild(cardEdu);
    wrapper.appendChild(secEdu);

    // Experience (sin bullets, solo t√≠tulos y fechas)
    const secExp = document.createElement('section');
    secExp.innerHTML = `<h2>Experience</h2>`;
    const cardExp = document.createElement('div');
    cardExp.className = 'card';
    const listExp = document.createElement('div');

    (experienceData || []).forEach(org => {
      const block = document.createElement('div');
      block.className = 'employer-block';
      const rolesHTML = (org.roles || []).map(role => {
        return `
          <div class="role role-slim">
            <h4 class="role-title">${role.title || ''}</h4>
            <p class="date">${role.date || ''}</p>
          </div>
        `;
      }).join('');
      block.innerHTML = `
        <h3 class="employer-name">${org.employer || ''}</h3>
        ${org.location ? `<p class="meta">${org.location}</p>` : ''}
        ${rolesHTML}
      `;
      listExp.appendChild(block);
    });
    cardExp.appendChild(listExp);
    secExp.appendChild(cardExp);
    wrapper.appendChild(secExp);

    // Skills (Technical Skills + Languages)
    const secSkills = document.createElement('section');
    secSkills.innerHTML = `<h2>Skills</h2>`;
    const cardSkills = document.createElement('div');
    cardSkills.className = 'card';

    let skillsHTML = '';
    if (skillsData?.technical?.length) {
      skillsHTML += '<h3>Technical Skills</h3><ul>';
      skillsData.technical.forEach(s => skillsHTML += `<li>${s}</li>`);
      skillsHTML += '</ul>';
    }
    if (skillsData?.languages?.length) {
      skillsHTML += '<h3>Languages</h3><ul>';
      skillsData.languages.forEach(l => skillsHTML += `<li>${l}</li>`);
      skillsHTML += '</ul>';
    }

    cardSkills.innerHTML = skillsHTML || '<p>(No skills listed)</p>';
    secSkills.appendChild(cardSkills);
    wrapper.appendChild(secSkills);


    // Scientific profiles
    const secSci = document.createElement('section');
    secSci.innerHTML = `<h2>Scientific profiles</h2>`;
    const cardSci = document.createElement('div');
    cardSci.className = 'card';
    cardSci.innerHTML = '<ul>' +
      (scienceData || []).map(link => `<li><a href="${link.url}" target="_blank" rel="noopener">${link.label}</a></li>`).join('') +
      '</ul>';
    secSci.appendChild(cardSci);
    wrapper.appendChild(secSci);

    // Personal Data
    const secPD = document.createElement('section');
    secPD.className = 'personal-data';
    secPD.innerHTML = `<h2>Personal Data</h2>`;
    const cardPD = document.createElement('div');
    cardPD.className = 'card';
    cardPD.innerHTML = `
      <p><strong>Nationality:</strong> ${personalData?.nationality || ''}</p>
      <p><strong>Born date:</strong> ${personalData?.birthdate || ''}</p>
    `;
    secPD.appendChild(cardPD);
    wrapper.appendChild(secPD);

    root.appendChild(wrapper);
  }

  pdfSimplifiedBtn.addEventListener('click', async () => {
    await Promise.all(loaders);
    if (document.fonts?.ready) await document.fonts.ready;

    // Construir clon simplificado
    buildSimplifiedDOM();

    // Mostrar solo el clon en impresi√≥n
    const root = document.getElementById('pdf-simplified');
    root.style.display = 'block';
    document.body.classList.add('print-simplified');

    const cleanup = () => {
      document.body.classList.remove('print-simplified');
      root.style.display = 'none';
      root.innerHTML = ''; // limpiar para evitar duplicados
    };

    // Manejo before/after print
    const after = () => {
      cleanup();
      window.removeEventListener('afterprint', after);
    };
    window.addEventListener('afterprint', after);

    window.print();
  });
</script>

</body>
</html>
